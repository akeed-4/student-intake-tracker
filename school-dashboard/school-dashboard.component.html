<div class="dashboard-container">
  <header class="dashboard-header">
      <button (click)="logout()" title="تسجيل الخروج" class="logout-button">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25-2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" /></svg>
      </button>
      <div class="title-group">
          <svg class="title-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21" /></svg>
          <h1 class="title">لوحة تحكم المدرسة</h1>
      </div>
      <p class="subtitle">متابعة طلبات الاستلام الحالية.</p>
  </header>
  <main class="dashboard-main">
    @if (pickupState.status() === 'idle' || pickupState.status() === 'picked_up') {
      <div class="no-requests-view">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>
          <h3 class="no-requests-title">لا توجد طلبات استلام حالية</h3>
          <p>سيتم عرض الطلبات هنا فور وصولها من أولياء الأمور.</p>
      </div>
    } @else {
      <div class="request-details-card">
        <div class="card-header">
            <div class="student-info">
                <h3 class="student-name">{{ pickupState.studentName() }}</h3>
                <p class="student-class">{{ pickupState.studentClass() }}</p>
            </div>
            @if (pickupState.status() === 'notified') { <span class="status-badge notified">تم الإبلاغ</span> }
            @if (pickupState.status() === 'teacher_alerted') { <span class="status-badge teacher-alerted">تم إبلاغ المعلم</span> }
            @if (pickupState.status() === 'ready') { <span class="status-badge ready">جاهز للاستلام</span> }
            @if (pickupState.status() === 'picked_up') { <span class="status-badge picked-up">تم التسليم</span> }
        </div>
        <div class="details-grid">
          <div class="detail-item">
              <p class="detail-label">المستلم</p>
              <p class="detail-value">{{ pickupState.pickupRequestAuthorizedPerson()?.name }} ({{ pickupState.pickupRequestAuthorizedPerson()?.relation }})</p>
          </div>
          <div class="detail-item">
              <p class="detail-label">وقت الوصول المقدر</p>
              <p class="detail-value">{{ pickupState.eta() }} دقيقة</p>
          </div>
          <div class="detail-item">
              <p class="detail-label">المركبة</p>
              @if(pickupState.carColor() || pickupState.carPlate()){
                  <p class="detail-value">{{ pickupState.carColor() || 'N/A' }} - {{ pickupState.carPlate() || 'N/A' }}</p>
              } @else {
                  <p class="detail-value not-specified">لم تحدد</p>
              }
          </div>
          <div class="detail-item">
              <p class="detail-label">رمز الاستلام</p>
              <p class="detail-value pickup-code">{{ pickupState.pickupCode() }}</p>
          </div>
        </div>
        @if(pickupState.notes()){
          <div class="notes-section">
              <p class="detail-label">ملاحظات ولي الأمر</p>
              <p class="notes-value">{{ pickupState.notes() }}</p>
          </div>
        }
        @if(pickupState.status() === 'notified') {
          <div class="card-actions">
             <button (click)="alertTeacher()" class="action-button">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" /></svg>
                إبلاغ المعلم
            </button>
          </div>
        }
      </div>
    }
  </main>
</div>
