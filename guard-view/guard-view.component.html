<div class="guard-view-container">
  <header class="guard-header">
      <button (click)="logout()" title="تسجيل الخروج" class="logout-button">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25-2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" /></svg>
      </button>
      <div class="title-group">
          <svg class="title-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.286Zm0 13.036h.008v.008h-.008v-.008Z" /></svg>
          <h1 class="title">شاشة حارس الأمن</h1>
      </div>
      <p class="subtitle">للتحقق من هوية المستلم.</p>
  </header>
  <main class="guard-main">
      @if(justConfirmedPickup()) {
        <div class="confirmation-view">
            <div class="confirmation-content">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>
                <h3 class="confirmation-title">تم التسليم بنجاح!</h3>
            </div>
        </div>
      } @else if (pickupState.status() === 'idle' || pickupState.status() === 'picked_up') {
          <div class="no-active-pickup">
            <p>لا توجد عمليات استلام نشطة حاليًا.</p>
          </div>
      } @else {
        @if(!pickupState.verifiedPickup()) {
          <div class="verification-form">
              <label for="guardCode" class="form-label">أدخل رمز الاستلام للتحقق</label>
              <input #guardCodeInput id="guardCode" type="text" inputmode="numeric" pattern="[0-9]*" [value]="guardInputCode()" (input)="onGuardCodeInput($event)" placeholder="----" class="code-input">
              @if (verificationError()) {
                <p class="verification-error">{{ verificationError() }}</p>
              }
              <div class="button-group">
                <button (click)="verifyCode()" class="verify-button">التحقق من الرمز</button>
                <button (click)="simulateScan()" class="scan-button">مسح QR (محاكاة)</button>
              </div>
          </div>
        } @else {
          <div class="verified-view">
              <p class="verified-message">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 1a4.5 4.5 0 0 0-4.5 4.5v2.25a2.25 2.25 0 0 0-2.25 2.25v3.75a2.25 2.25 0 0 0 2.25 2.25h9A2.25 2.25 0 0 0 16.75 14V10.25a2.25 2.25 0 0 0-2.25-2.25V5.5A4.5 4.5 0 0 0 10 1Zm3 8.25V5.5a3 3 0 0 0-6 0v3.75a.75.75 0 0 1-1.5 0V5.5a4.5 4.5 0 0 1 9 0v3.75a.75.75 0 0 1-1.5 0Z" clip-rule="evenodd" /></svg>
                  تم التحقق من الرمز بنجاح!
              </p>
               <!-- Authorized Person Details -->
              <div class="person-details">
                  <img [src]="pickupState.verifiedPickup()?.authorizedPerson.photo" alt="صورة المستلم" class="person-photo">
                  <p class="person-name">{{ pickupState.verifiedPickup()?.authorizedPerson.name }}</p>
                  <p class="person-relation">{{ pickupState.verifiedPickup()?.authorizedPerson.relation }}</p>
                  <p class="person-id">ID: {{ pickupState.verifiedPickup()?.authorizedPerson.idNumber }}</p>
              </div>

               <!-- Student Details -->
              <div class="student-details">
                  <p class="student-label">الطالب:</p>
                  <h3 class="student-name">{{ pickupState.verifiedPickup()?.studentName }}</h3>
                  <p class="student-class">{{ pickupState.verifiedPickup()?.studentClass }}</p>
              </div>
             <button (click)="confirmPickup()" class="confirm-button">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>
                تأكيد تسليم الطالب
            </button>
          </div>
        }
      }
  </main>
</div>
