<div class="dashboard-container">
  <header class="dashboard-header">
      <button (click)="logout()" title="تسجيل الخروج" class="logout-button">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25-2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9" /></svg>
      </button>
      <div class="title-group">
          <svg class="title-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg>
          <h1 class="title">بوابة المعلم</h1>
      </div>
      <p class="subtitle">متابعة طلبات الاستلام وإرسال الطلاب للبوابة.</p>
  </header>
  <main class="dashboard-main">
    @if (pickupState.status() === 'idle' || pickupState.status() === 'picked_up' || pickupState.status() === 'notified') {
      <div class="no-requests-view">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>
          <h3 class="no-requests-title">لا توجد طلبات استلام حالية</h3>
          <p>سيتم عرض الطلبات هنا فور وصولها.</p>
      </div>
    } @else {
      <div class="request-details-card">
        <div class="card-header">
            <div class="student-info">
                <h3 class="student-name">{{ pickupState.studentName() }}</h3>
                <p class="student-class">{{ pickupState.studentClass() }}</p>
            </div>
            @if (pickupState.status() === 'teacher_alerted') { <span class="status-badge new-request">طلب جديد</span> }
            @if (pickupState.status() === 'ready') { <span class="status-badge sent">تم الإرسال</span> }
        </div>
        <div class="details-grid">
          <div class="detail-item">
              <p class="detail-label">المستلم</p>
              <p class="detail-value">{{ pickupState.pickupRequestAuthorizedPerson()?.name }}</p>
          </div>
          <div class="detail-item">
              <p class="detail-label">وقت الوصول المقدر</p>
              <p class="detail-value">{{ pickupState.eta() }} دقيقة</p>
          </div>
        </div>
        @if(pickupState.notes()){
          <div class="notes-section">
              <p class="detail-label">ملاحظات ولي الأمر</p>
              <p class="notes-value">{{ pickupState.notes() }}</p>
          </div>
        }
        @if(pickupState.status() === 'teacher_alerted') {
          <div class="card-actions">
             <button (click)="markAsReady()" class="action-button">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" /></svg>
                إرسال الطالب للبوابة
            </button>
          </div>
        }
        @if (pickupState.status() === 'ready') {
          <div class="confirmation-message">
            <p>تم إرسال الطالب. هو/هي في طريقه/ها إلى البوابة.</p>
          </div>
        }
      </div>
    }
  </main>
</div>
